import pandas as pd
import seaborn as sns
import matplotlib.pyplot as plt
import streamlit as st 
from functions import *
import numpy as np
"""
st.set_option('deprecation.showPyplotGlobalUse', False)
sns.set_style({'axes.facecolor':'23606E',
               'figure.facecolor': '23606E', 
               'axes.labelcolor': 'F5F5F5',
               'axes.axisbelow': True,
               'axes.edgecolor': '327E8F',
               'text.color':'F5F5F5',
               'xtick.color': 'F5F5F5',
              'ytick.color': 'F5F5F5',
              'grid.color': '327E8F'})
#sns.set_facecolor("#23606E")

"""
st.set_page_config(page_title="–ê–Ω–∞–ª–∏–∑ –∑–∞—Ä–ø–ª–∞—Ç", page_icon="üíÄ")


url = "https://xn----ctbjnaatncev9av3a8f8b.xn--p1ai/%D1%82%D0%B0%D0%B1%D0%BB%D0%B8%D1%86%D1%8B-%D0%B8%D0%BD%D1%84%D0%BB%D1%8F%D1%86%D0%B8%D0%B8"

#load all datas
salaries =  load_excel_data('data/Rosstat Labor Market 2023.xlsx')
inflation = load_html_data(url)
inflation = inflation[['–ì–æ–¥','–í—Å–µ–≥–æ']][:26] #from 1999
areas = ['–†—ã–±–æ–ª–æ–≤—Å—Ç–≤–æ, —Ä—ã–±–æ–≤–æ–¥—Å—Ç–≤–æ', '–°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ', '–î–æ–±—ã—á–∞ –ø–æ–ª–µ–∑–Ω—ã—Ö –∏—Å–∫–æ–ø–∞–µ–º—ã—Ö','–ì–æ—Å—Ç–∏–Ω–∏—Ü—ã –∏ —Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã','–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ','–ó–¥—Ä–∞–≤–æ–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —É—Å–ª—É–≥']
years = np.arange(2000, 2024, 1)

salary_df_1 = pd.DataFrame(salaries['sheet1'])# –¥–æ 2016
salary_df_2 = pd.DataFrame(salaries['sheet2'])# c 2017
salary_df_1 = salary_df_1.rename(columns={'–≥–æ–¥':'Area'})
salary_df_2 = salary_df_2.rename(columns={'–≥–æ–¥':'Area'})
interested_areas = choose_areas_and_concat(salary_df_1, salary_df_2, areas)

del salary_df_1
del salary_df_2


st.title("–ê–Ω–∞–ª–∏–∑ –∑–∞—Ä–ø–ª–∞—Ç –≤ –†–æ—Å—Å–∏–∏ –≤ –ø–µ—Ä–∏–æ–¥ —Å 2000 –ø–æ 2023 –≥–æ–¥—ã")
st.text("–ü—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é –∞–Ω–∞–ª–∏–∑ —Ä–µ–∞–ª—å–Ω—ã—Ö –∑–∞—Ä–ø–ª–∞—Ç –≤ –†–æ—Å—Å–∏–∏ —Å —É—á–µ—Ç–æ–º –∏–Ω—Ñ–ª—è—Ü–∏–∏")


st.sidebar.title('About')

area = st.sidebar.selectbox("–°—Ñ–µ—Ä—ã –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏", areas)
radio = st.sidebar.radio('–í—ã–≤–µ—Å—Ç–∏ –≥—Ä–∞—Ñ–∏–∫', 
    options=['–ù–æ–º–∏–Ω–∞–ª—å–Ω–∞—è –∑–∞—Ä–ø–ª–∞—Ç–∞','–†–µ–∞–ª—å–Ω–∞—è –∑–∞—Ä–ø–ª–∞—Ç–∞ VS –ù–æ–º–∏–Ω–∞–ª—å–Ω–∞—è','–ò–Ω—Ñ–ª—è—Ü–∏—è', '–†–∞–∑–Ω–æ—Å—Ç—å –≤ –∑–∞—Ä–ø–ª–∞—Ç–∞—Ö'])

if radio == '–ù–æ–º–∏–Ω–∞–ª—å–Ω–∞—è –∑–∞—Ä–ø–ª–∞—Ç–∞':
    values = interested_areas[interested_areas['Area']==area].values[0][1:]
    title=f'–ù–æ–º–∏–Ω–∞–ª—å–Ω–∞—è –∑–∞—Ä–ø–ª–∞—Ç–∞ –≤ —Å—Ñ–µ—Ä–µ {area}'
    ylabel='—Ä—É–±–ª–µ–π'
    xlabel = None
    fig = plot_xy(values, years, title=title, ylabel= ylabel, xlabel=xlabel)
    st.pyplot(fig)
    st.info("""
            –ò–∑ –¥–∞–Ω–Ω—ã—Ö –≥—Ä–∞—Ñ–∏–∫–æ–≤ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –≤—ã–≤–æ–¥ –æ —Ç–æ–º, —á—Ç–æ –µ–∂–µ–≥–æ–¥–Ω–æ –∑–∞—Ä–ø–ª–∞—Ç—ã –≤ –¥–∞–Ω–Ω—ã—Ö —Å—Ñ–µ—Ä–∞—Ö —Ä–∞—Å—Ç—É—Ç.
            –ü—Ä–∏—á–Ω–æ–π –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—ã—Ö–æ–¥ —Å—Ç—Ä–∞–Ω—ã –Ω–∞ –º–∏—Ä–æ–≤–æ–π —Ä—ã–Ω–æ–∫.
            –¢–∞–∫–∂–µ –≤ —Å—Ä–µ–¥–Ω–µ–º —É—Ä–æ–≤–µ–Ω—å –∂–∏–∑–Ω–∏ –≤ —Å—Ç—Ä–∞–Ω–µ —Å 2000-–≥–æ –≥–æ–¥–∞ –ø–æ–¥–Ω—è–ª—Å—è, –∏–∑ —á–µ–≥–æ –º–æ–∂–µ—Ç —Å–ª–µ–¥–æ–≤–∞—Ç—å —Ä–æ—Å—Ç —Å–ø—Ä–æ—Å–∞ –∏ –≤–Ω—É—Ç—Ä–∏ —Å—Ç—Ä–∞–Ω—ã —Ç–æ–∂–µ.
            –¢–∞–∫–∂–µ –Ω–µ —Å—Ç–æ–∏—Ç –∑–∞–±—ã–≤–∞—Ç—å –æ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–µ—Ä–µ–∂–∏—Ç—ã—Ö –∫—Ä–∏–∑–∏—Å–∞—Ö. –†–æ—Å—Ç –∑–∞—Ä–ø–ª–∞—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–≤—è–∑–∞–Ω —Å –∏–Ω—Ñ–ª—è—Ü–∏–µ–π. –ü–æ—Å–∫–æ–ª—å–∫—É —É—Ä–æ–≤–µ–Ω—å –∏–Ω—Ñ–ª—è—Ü–∏–∏ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Ü–µ–Ω—ã –Ω–∞ —Ç–æ–≤–∞—Ä—ã –∏ —É—Å–ª—É–≥–∏, —Ä–∞–±–æ—Ç–Ω–∏–∫–∏ –º–æ–≥—É—Ç —Ç—Ä–µ–±–æ–≤–∞—Ç—å –ø–æ–≤—ã—à–µ–Ω–∏—è –∑–∞—Ä–ø–ª–∞—Ç—ã, —á—Ç–æ–±—ã –∫–æ–º–ø–µ–Ω—Å–∏—Ä–æ–≤–∞—Ç—å —É—Ö—É–¥—à–µ–Ω–∏–µ –ø–æ–∫—É–ø–∞—Ç–µ–ª—å–Ω–æ–π —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ —Å–≤–æ–∏—Ö –¥–æ—Ö–æ–¥–æ–≤.                       
            """)

elif radio == '–†–µ–∞–ª—å–Ω–∞—è –∑–∞—Ä–ø–ª–∞—Ç–∞ VS –ù–æ–º–∏–Ω–∞–ª—å–Ω–∞—è':
    nominal_wage = interested_areas[interested_areas['Area']==area].values[0][1:]
    real_wage = real_wage(interested_areas,years,area,inflation)
    title= f"–ó–∞—Ä–ø–ª–∞—Ç–∞ –≤ —Å—Ñ–µ—Ä–µ {area} —Å —É—á–µ—Ç–æ–º –∏–Ω—Ñ–ª—è—Ü–∏–∏ –ø–æ –æ—Ç–Ω–æ—à–µ–Ω–∏—é –∫ –ø—Ä–æ—à–ª–æ–º—É –≥–æ–¥—É"
    ylabel= '—Ä—É–±–ª–µ–π'
    xlabel=None
    real_label = "–†–µ–∞–ª—å–Ω–∞—è –∑–∞—Ä–ø–ª–∞—Ç–∞"
    nominal_label = "–ù–æ–º–∏–Ω–∞–ª—å–Ω–∞—è –∑–∞—Ä–ø–ª–∞—Ç–∞"
    fig = plot_2graphs(years, nominal_wage, real_wage, title, xlabel, ylabel,label_2=real_label, label_1=nominal_label)
    st.pyplot(fig, use_container_width=True)
    st.info("""
–ò–∑ –≥—Ä–∞—Ñ–∏–∫–æ–≤ –≤—ã—à–µ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤—ã–≤–æ–¥–æ–≤:

–ù–æ–º–∏–Ω–∞–ª—å–Ω–∞—è –∑–∞—Ä–ø–ª–∞—Ç–∞ —Ä–æ—Å–ª–∞ –≤–µ—Å—å –ø–µ—Ä–∏–æ–¥
–†–µ–∞–ª—å–Ω–∞—è –∑–∞—Ä–ø–ª–∞—Ç–∞ —Ä–æ—Å–ª–∞ –≤–µ—Å—å –ø–µ—Ä–∏–æ–¥, –Ω–æ –∏–Ω—Ñ–ª—è—Ü–∏—è –¥–∞–≤–∞–ª–∞ –æ —Å–µ–±–µ –∑–Ω–∞—Ç—å, –∏ —Ä–æ—Å—Ç –Ω–æ–º–∏–Ω–∞–ª—å–Ω–æ–π –∑–∞—Ä–ø–ª–∞—Ç—ã –Ω–µ —Å–≥–ª–∞–∂–∏–≤–∞–µ—Ç —Ä–æ—Å—Ç–∞ –∏–Ω—Ñ–ª—è—Ü–∏–∏
–í –ø–µ—Ä–∏–æ–¥ 2014-2015 –≥–æ–¥–æ–≤, —Ä–µ–∞–ª—å–Ω–∞—è –∑–∞—Ä–ø–ª–∞—Ç–∞ –≤ —Å—Ñ–µ—Ä–µ "–°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ" —Å–Ω–∏–∑–∏–ª–∞—Å—å. –ü—Ä–∏—á–∏–Ω–æ–π –º–æ–≥–ª–æ —Å—Ç–∞—Ç—å –Ω–∞–ª–æ–∂–µ–Ω–∏–µ —Å–∞–Ω–∫—Ü–∏–π –∏ —Å–ª–µ–¥—É—é—â–µ–µ –∑–∞ –Ω–∏–º–∏ —Å–Ω–∏–∂–µ–Ω–∏–µ –ø–æ–∫—É–ø–∞—Ç–µ–ª—å—Å–∫–æ–π —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
–ü–æ–∫—É–ø–∞—Ç–µ–ª—å—Å–∫–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –ø–∞–¥–∞–µ—Ç, –∫–∞–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è —Ä–µ–∞–ª—å–Ω–æ–π –∏ –Ω–æ–º–∏–Ω–∞–ª—å–Ω–æ–π –∑–∞—Ä–ø–ª–∞—Ç—ã
–ü—Ä–∏—á–∏–Ω–∞–º–∏ –º–æ–≥—É—Ç –±—ã—Ç—å:

–ì–ª–æ–±–∞–ª—å–Ω—ã–π –º–∏—Ä–æ–≤–æ–π –∫—Ä–∏–∑–∏—Å
–°–Ω–∏–∂–µ–Ω–∏–µ —Ü–µ–Ω –Ω–∞ —Å—ã—Ä—å–µ
–†–æ—Å—Ç –∏–Ω—Ñ–ª—è—Ü–∏–∏
            """)


elif radio == '–ò–Ω—Ñ–ª—è—Ü–∏—è':
    values= [val for val in inflation['–í—Å–µ–≥–æ'][::-1]]
    title= "–ó–Ω–∞—á–µ–Ω–∏–µ –∏–Ω—Ñ–ª—è—Ü–∏–∏"
    ylabel= "%"
    fig = plot_xy(values[1:25],years, title= title, ylabel=ylabel, xlabel=None)
    st.pyplot(fig)
    st.info("""–ù–∞–±–ª—é–¥–∞–µ—Ç—Å—è —Ä–æ—Å—Ç –∏–Ω—Ñ–ª—è—Ü–∏–∏. –û–Ω–∞ —Ä–∞—Å—Ç–µ—Ç —Å–∫–∞—á–∫–æ–æ–±—Ä–∞–∑–Ω–æ, —á—Ç–æ –Ω–µ–≥–∞—Ç–∏–≤–Ω–æ —Å–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –Ω–∞ —ç–∫–æ–Ω–æ–º–∏–∫–µ,
            —Ç–∞–∫ –∫–∞–∫ –¥–æ–≤–æ–ª—å–Ω–æ —Å–ª–æ–∂–Ω–æ —Å–≥–ª–∞–¥–∏—Ç—å –µ–µ""")

elif radio == '–†–∞–∑–Ω–æ—Å—Ç—å –≤ –∑–∞—Ä–ø–ª–∞—Ç–∞—Ö':
    nominal_wage = interested_areas[interested_areas['Area']==area].values[0][1:]
    real_wage = real_wage(interested_areas,years,area,inflation)
    values = (1-real_wage/nominal_wage)*100
    title= f'–†–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É —Ä–µ–∞–ª—å–Ω–æ–π –∏ –Ω–æ–º–∏–Ω–∞–ª—å–Ω–æ–π –∑–∞—Ä–∞–±–æ—Ç–Ω–æ–π –ø–ª–∞—Ç–æ–π –≤ —Å—Ñ–µ—Ä–µ: {area}'
    ylabel="%"
    fig = bar_plot(years, values,title,ylabel, xlabel=None )
    st.pyplot(fig)
    st.info("""–ò–∑ –≥—Ä–∞—Ñ–∏–∫–æ–≤ –≤—ã—à–µ –º—ã –≤–∏–¥–∏–º, —á—Ç–æ –≤ –ø–µ—Ä–∏–æ–¥ —Å 2000 –ø–æ 2018 —Ä–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É —Ä–µ–∞–ª—å–Ω–æ–π –∏ –Ω–æ–º–∏–Ω–∞–ª—å–Ω–æ–π –∑–∞—Ä–∞–±–æ—Ç–Ω–æ–π –ø–ª–∞—Ç–æ–π —É–º–µ–Ω—å—à–∞–ª–∞—Å—å —Å –Ω–µ–∫–æ—Ç–æ—Ä—ã–º–∏ –≤—ã–±—Ä–æ—Å–∞–º–∏, –æ–±—É—Å–ª–æ–≤–ª–µ–Ω–Ω—ã–º–∏ —á–∞—Å—Ç–Ω—ã–º–∏ —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–º–∏ –ø—Ä–æ–±–ª–µ–º–∞–º–∏, —á—Ç–æ –≥–æ–≤–æ—Ä–∏—Ç –æ —Ç–æ–º, —á—Ç–æ —Å—Ç—Ä–∞–Ω–∞ —Ä–∞–∑–≤–∏–≤–∞–ª–∞—Å—å –∏ –±—ã–ª —Ä–µ–∞–ª—å–Ω—ã–π —Ä–æ—Å—Ç –¥–æ—Ö–æ–¥–æ–≤.

–ù–∞—á–∏–Ω–∞—è —Å 2019 –≥–æ–¥–∞, —Ä–æ—Å—Ç –¥–æ—Ö–æ–¥–æ–≤ –ø—Ä–µ–∫—Ä–∞—Ç–∏–ª—Å—è.""")

